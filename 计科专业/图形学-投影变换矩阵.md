
# 投影变换矩阵
理清从对象空间到屏幕空间的整个变换流程，包括中间变换公式的理解。

## 术语表
- 对象空间，object space
- 世界空间，world space
- 相机空间，camera space，eye space
- 裁剪空间，标准视见体，clip space，canonical view volume，normalized device coordinates
- 屏幕空间，screen space，pixel coordinates
- 正投影，orthographic projection
- 透视投影，perspective projection


## 空间变换关系
![Viewing transformations](images/view_trans.JPG)

*说明* 投影变换将相机空间里的点映射到$$[-1, 1]^3$$的裁剪空间，所有映射后不在这个区间
里的点都会被裁剪掉。透视投影先将自己的视见体(view volume)变换成正交投影的视见体，然后再
统一使用正交投影的变换矩阵将视见体里的点变换到裁剪空间。

## 细节
### 标准视见体到屏幕的变换
就是将$$[-1, 1]^3$$映射到[0, nx]$$\times$$[0, ny]，nx、ny分别是水平和垂直方向上的像素数量。
容易得到变换矩阵如下：

$$M_{vp} = \left[ 
\begin{matrix}
\frac{nx}{2}&0&0&\frac{nx}{2} \\
0&\frac{ny}{2}&0&\frac{ny}{2}\\
0&0&1&0\\
0&0&0&1
\end{matrix} 
\right]$$

**Note**：z坐标的数值保留下来了，用于后续的深度检测及其他操作。

### 正投影
首先定义正投影的视见体，如下图：

![正投影视见体](images/orth_view_volume.JPG)

其中t、b、l、r、f和n分别定义了上下左右以及远近6个平面，因为该视见体位于z轴的负方向，所以n > f。

使用下面的矩阵将正投影的视见体变换成标准视见体：

$$
M_{orth} = \left[
\begin{matrix}
\frac{2}{r-l} & 0 & 0 & -\frac{r+l}{r-l}\\
0 & \frac{2}{t-b} & 0 & -\frac{t+b}{t-b}\\
0 & 0 & \frac{2}{n-f}& -\frac{n+f}{n-f}
\end{matrix}
\right]
$$

----
参考：Fundamentals of Computer Graphics, 3rd edition

